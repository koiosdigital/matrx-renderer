{
    "openapi": "3.0.0",
    "info": {
        "title": "Matrx Renderer API",
        "description": "HTTP API for managing and rendering Pixlet applications for Matrx devices",
        "version": "1.0.0"
    },
    "servers": [
        {
            "url": "http://localhost:8080",
            "description": "Local development server"
        }
    ],
    "paths": {
        "/health": {
            "get": {
                "summary": "Health check",
                "description": "Returns the health status of the service",
                "operationId": "getHealth",
                "responses": {
                    "200": {
                        "description": "Service is healthy",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/HealthResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/apps": {
            "get": {
                "summary": "List all apps",
                "description": "Returns a list of all available Pixlet applications",
                "operationId": "listApps",
                "responses": {
                    "200": {
                        "description": "List of apps",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "array",
                                    "items": {
                                        "$ref": "#/components/schemas/AppManifest"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "/apps/refresh": {
            "post": {
                "summary": "Refresh app registry",
                "description": "Reloads the app registry from the filesystem",
                "operationId": "refreshApps",
                "responses": {
                    "200": {
                        "description": "Apps refreshed successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/RefreshAppsResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Failed to refresh apps"
                    }
                }
            }
        },
        "/apps/{id}": {
            "parameters": [
                {
                    "name": "id",
                    "in": "path",
                    "required": true,
                    "description": "App identifier",
                    "schema": {
                        "type": "string"
                    }
                }
            ],
            "get": {
                "summary": "Get app details",
                "description": "Returns detailed information about a specific app",
                "operationId": "getApp",
                "responses": {
                    "200": {
                        "description": "App details",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/AppManifest"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "App not found"
                    }
                }
            }
        },
        "/apps/{id}/schema": {
            "parameters": [
                {
                    "name": "id",
                    "in": "path",
                    "required": true,
                    "description": "App identifier",
                    "schema": {
                        "type": "string"
                    }
                }
            ],
            "get": {
                "summary": "Get app schema",
                "description": "Returns the schema definition for a specific app",
                "operationId": "getAppSchema",
                "responses": {
                    "200": {
                        "description": "App schema",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/AppSchema"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "App not found"
                    },
                    "500": {
                        "description": "Failed to load schema"
                    }
                }
            },
            "post": {
                "summary": "Validate schema configuration",
                "description": "Validates a configuration object against the app's schema",
                "operationId": "validateSchema",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/AppConfig"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Validation result",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ValidateSchemaResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Invalid JSON body"
                    },
                    "404": {
                        "description": "App not found"
                    },
                    "500": {
                        "description": "Failed to load schema"
                    }
                }
            }
        },
        "/apps/{id}/render": {
            "parameters": [
                {
                    "name": "id",
                    "in": "path",
                    "required": true,
                    "description": "App identifier",
                    "schema": {
                        "type": "string"
                    }
                }
            ],
            "post": {
                "summary": "Render app",
                "description": "Renders an app configuration and returns the base64-encoded WebP payload.",
                "operationId": "renderApp",
                "parameters": [
                    {
                        "name": "width",
                        "in": "query",
                        "required": false,
                        "description": "Device width in pixels (default 64)",
                        "schema": {
                            "type": "integer",
                            "format": "int32"
                        }
                    },
                    {
                        "name": "height",
                        "in": "query",
                        "required": false,
                        "description": "Device height in pixels (default 32)",
                        "schema": {
                            "type": "integer",
                            "format": "int32"
                        }
                    },
                    {
                        "name": "device_id",
                        "in": "query",
                        "required": false,
                        "description": "Optional device identifier used for logging",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/AppConfig"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Render result",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/RenderResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Invalid request"
                    },
                    "404": {
                        "description": "App not found"
                    },
                    "422": {
                        "description": "Validation failed",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ValidateSchemaResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Failed to render app"
                    }
                }
            }
        },
        "/apps/{id}/preview.webp": {
            "parameters": [
                {
                    "name": "id",
                    "in": "path",
                    "required": true,
                    "description": "App identifier",
                    "schema": {
                        "type": "string"
                    }
                }
            ],
            "get": {
                "summary": "Render WebP preview",
                "description": "Renders an app using schema defaults (no request body) and returns binary WebP output.",
                "operationId": "previewWebP",
                "parameters": [
                    {
                        "name": "width",
                        "in": "query",
                        "required": false,
                        "description": "Device width in pixels (default 64)",
                        "schema": {
                            "type": "integer",
                            "format": "int32"
                        }
                    },
                    {
                        "name": "height",
                        "in": "query",
                        "required": false,
                        "description": "Device height in pixels (default 32)",
                        "schema": {
                            "type": "integer",
                            "format": "int32"
                        }
                    },
                    {
                        "name": "device_id",
                        "in": "query",
                        "required": false,
                        "description": "Optional device identifier used for logging",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Binary WebP image",
                        "content": {
                            "image/webp": {
                                "schema": {
                                    "type": "string",
                                    "format": "binary"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Invalid request"
                    },
                    "404": {
                        "description": "App not found"
                    },
                    "500": {
                        "description": "Failed to render preview"
                    }
                }
            }
        },
        "/apps/{id}/preview.gif": {
            "parameters": [
                {
                    "name": "id",
                    "in": "path",
                    "required": true,
                    "description": "App identifier",
                    "schema": {
                        "type": "string"
                    }
                }
            ],
            "get": {
                "summary": "Render GIF preview",
                "description": "Renders an app using schema defaults (no request body) and returns binary GIF output.",
                "operationId": "previewGif",
                "parameters": [
                    {
                        "name": "width",
                        "in": "query",
                        "required": false,
                        "description": "Device width in pixels (default 64)",
                        "schema": {
                            "type": "integer",
                            "format": "int32"
                        }
                    },
                    {
                        "name": "height",
                        "in": "query",
                        "required": false,
                        "description": "Device height in pixels (default 32)",
                        "schema": {
                            "type": "integer",
                            "format": "int32"
                        }
                    },
                    {
                        "name": "device_id",
                        "in": "query",
                        "required": false,
                        "description": "Optional device identifier used for logging",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Binary GIF image",
                        "content": {
                            "image/gif": {
                                "schema": {
                                    "type": "string",
                                    "format": "binary"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Invalid request"
                    },
                    "404": {
                        "description": "App not found"
                    },
                    "500": {
                        "description": "Failed to render preview"
                    }
                }
            }
        },
        "/apps/{id}/call_handler": {
            "parameters": [
                {
                    "name": "id",
                    "in": "path",
                    "required": true,
                    "description": "App identifier",
                    "schema": {
                        "type": "string"
                    }
                }
            ],
            "post": {
                "summary": "Call schema handler",
                "description": "Calls a schema handler for dynamic field resolution",
                "operationId": "callSchemaHandler",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/CallSchemaHandlerRequest"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Handler result",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/CallSchemaHandlerResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Invalid request"
                    },
                    "404": {
                        "description": "App or handler not found"
                    },
                    "422": {
                        "description": "Handler parameter validation failed (e.g. OAuth2 missing client_id, code_verifier, or client_secret)",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ValidateSchemaResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Failed to invoke schema handler"
                    }
                }
            }
        },
        "/swagger.json": {
            "get": {
                "summary": "OpenAPI specification",
                "description": "Returns the OpenAPI/Swagger specification for this API",
                "operationId": "getSwagger",
                "responses": {
                    "200": {
                        "description": "OpenAPI specification",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object"
                                }
                            }
                        }
                    }
                }
            }
        }
    },
    "components": {
        "schemas": {
            "HealthResponse": {
                "type": "object",
                "properties": {
                    "status": {
                        "type": "string",
                        "example": "healthy"
                    },
                    "service": {
                        "type": "string",
                        "example": "matrx-renderer"
                    },
                    "version": {
                        "type": "string",
                        "example": "1.0.0"
                    }
                },
                "required": [
                    "status",
                    "service",
                    "version"
                ]
            },
            "AppManifest": {
                "type": "object",
                "properties": {
                    "id": {
                        "type": "string",
                        "description": "Unique app identifier"
                    },
                    "name": {
                        "type": "string",
                        "description": "Display name"
                    },
                    "summary": {
                        "type": "string",
                        "description": "Short summary"
                    },
                    "description": {
                        "type": "string",
                        "description": "Detailed description"
                    },
                    "author": {
                        "type": "string",
                        "description": "App author"
                    },
                    "fileName": {
                        "type": "string",
                        "description": "Primary .star file"
                    },
                    "packageName": {
                        "type": "string",
                        "description": "Package name used internally"
                    },
                    "directoryPath": {
                        "type": "string",
                        "description": "Absolute path to the app directory"
                    },
                    "starFilePath": {
                        "type": "string",
                        "description": "Absolute path to the entry .star file"
                    }
                },
                "required": [
                    "id",
                    "name",
                    "summary",
                    "description",
                    "author",
                    "fileName",
                    "packageName"
                ]
            },
            "AppSchema": {
                "type": "object",
                "properties": {
                    "version": {
                        "type": "string",
                        "description": "Schema version"
                    },
                    "schema": {
                        "type": "array",
                        "description": "Configurable fields",
                        "items": {
                            "$ref": "#/components/schemas/AppSchemaField"
                        }
                    },
                    "notifications": {
                        "type": "array",
                        "description": "Supported notifications",
                        "items": {
                            "$ref": "#/components/schemas/AppSchemaNotificationField"
                        }
                    }
                },
                "required": [
                    "version",
                    "schema"
                ]
            },
            "AppSchemaField": {
                "description": "Discriminated schema field definition",
                "oneOf": [
                    {
                        "$ref": "#/components/schemas/AppSchemaColorField"
                    },
                    {
                        "$ref": "#/components/schemas/AppSchemaDatetimeField"
                    },
                    {
                        "$ref": "#/components/schemas/AppSchemaDropdownField"
                    },
                    {
                        "$ref": "#/components/schemas/AppSchemaGeneratedField"
                    },
                    {
                        "$ref": "#/components/schemas/AppSchemaLocationField"
                    },
                    {
                        "$ref": "#/components/schemas/AppSchemaLocationBasedField"
                    },
                    {
                        "$ref": "#/components/schemas/AppSchemaOnOffField"
                    },
                    {
                        "$ref": "#/components/schemas/AppSchemaRadioField"
                    },
                    {
                        "$ref": "#/components/schemas/AppSchemaTextField"
                    },
                    {
                        "$ref": "#/components/schemas/AppSchemaTypeaheadField"
                    },
                    {
                        "$ref": "#/components/schemas/AppSchemaOAuth2Field"
                    },
                    {
                        "$ref": "#/components/schemas/AppSchemaOAuth1Field"
                    },
                    {
                        "$ref": "#/components/schemas/AppSchemaPNGField"
                    },
                    {
                        "$ref": "#/components/schemas/AppSchemaNotificationField"
                    },
                    {
                        "$ref": "#/components/schemas/AppSchemaGeoJSONField"
                    }
                ],
                "discriminator": {
                    "propertyName": "type",
                    "mapping": {
                        "color": "#/components/schemas/AppSchemaColorField",
                        "datetime": "#/components/schemas/AppSchemaDatetimeField",
                        "dropdown": "#/components/schemas/AppSchemaDropdownField",
                        "generated": "#/components/schemas/AppSchemaGeneratedField",
                        "geojson": "#/components/schemas/AppSchemaGeoJSONField",
                        "location": "#/components/schemas/AppSchemaLocationField",
                        "locationbased": "#/components/schemas/AppSchemaLocationBasedField",
                        "onoff": "#/components/schemas/AppSchemaOnOffField",
                        "radio": "#/components/schemas/AppSchemaRadioField",
                        "text": "#/components/schemas/AppSchemaTextField",
                        "typeahead": "#/components/schemas/AppSchemaTypeaheadField",
                        "oauth2": "#/components/schemas/AppSchemaOAuth2Field",
                        "oauth1": "#/components/schemas/AppSchemaOAuth1Field",
                        "png": "#/components/schemas/AppSchemaPNGField",
                        "notification": "#/components/schemas/AppSchemaNotificationField"
                    }
                }
            },
            "AppSchemaOption": {
                "type": "object",
                "properties": {
                    "display": {
                        "type": "string"
                    },
                    "text": {
                        "type": "string"
                    },
                    "value": {
                        "type": "string"
                    }
                },
                "required": [
                    "text",
                    "value"
                ]
            },
            "AppSchemaSound": {
                "type": "object",
                "properties": {
                    "id": {
                        "type": "string"
                    },
                    "title": {
                        "type": "string"
                    },
                    "path": {
                        "type": "string"
                    }
                },
                "required": [
                    "id",
                    "title",
                    "path"
                ]
            },
            "AppSchemaVisibility": {
                "type": "object",
                "properties": {
                    "type": {
                        "type": "string",
                        "enum": [
                            "invisible",
                            "disabled"
                        ]
                    },
                    "condition": {
                        "type": "string",
                        "enum": [
                            "equal",
                            "not_equal"
                        ]
                    },
                    "variable": {
                        "type": "string"
                    },
                    "value": {
                        "type": "string"
                    }
                },
                "required": [
                    "type",
                    "condition",
                    "variable"
                ]
            },
            "AppConfig": {
                "type": "object",
                "description": "Arbitrary configuration object keyed by schema field IDs",
                "additionalProperties": true
            },
            "ValidationError": {
                "type": "object",
                "properties": {
                    "field": {
                        "type": "string",
                        "description": "Field identifier"
                    },
                    "message": {
                        "type": "string",
                        "description": "Human readable error"
                    },
                    "code": {
                        "type": "string",
                        "description": "Machine readable error code",
                        "enum": [
                            "required",
                            "unknown_field",
                            "invalid_type",
                            "invalid_color",
                            "invalid_bool",
                            "invalid_option",
                            "invalid_datetime",
                            "invalid_location",
                            "invalid_location_option",
                            "invalid_selection",
                            "invalid_image",
                            "invalid_notification",
                            "missing_credentials",
                            "invalid_geojson",
                            "invalid_polygon",
                            "invalid_point",
                            "missing_point",
                            "invalid_handler_data",
                            "missing_client_id",
                            "missing_code_verifier",
                            "missing_client_secret"
                        ]
                    }
                },
                "required": [
                    "field",
                    "message",
                    "code"
                ]
            },
            "ValidateSchemaResponse": {
                "type": "object",
                "properties": {
                    "valid": {
                        "type": "boolean"
                    },
                    "errors": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/ValidationError"
                        }
                    },
                    "normalized_config": {
                        "$ref": "#/components/schemas/AppConfig"
                    }
                },
                "required": [
                    "valid",
                    "normalized_config"
                ]
            },
            "RenderResult": {
                "type": "object",
                "properties": {
                    "type": {
                        "type": "string"
                    },
                    "uuid": {
                        "type": "string"
                    },
                    "device_id": {
                        "type": "string"
                    },
                    "app_id": {
                        "type": "string"
                    },
                    "render_output": {
                        "type": "string",
                        "description": "Base64 encoded WebP payload"
                    },
                    "processed_at": {
                        "type": "string",
                        "format": "date-time"
                    }
                },
                "required": [
                    "type",
                    "uuid",
                    "app_id",
                    "render_output",
                    "processed_at"
                ]
            },
            "RenderResponse": {
                "type": "object",
                "properties": {
                    "result": {
                        "$ref": "#/components/schemas/RenderResult"
                    },
                    "normalized_config": {
                        "$ref": "#/components/schemas/AppConfig"
                    }
                },
                "required": [
                    "result",
                    "normalized_config"
                ]
            },
            "CallSchemaHandlerRequest": {
                "type": "object",
                "properties": {
                    "handler_name": {
                        "type": "string",
                        "description": "Handler to invoke"
                    },
                    "data": {
                        "type": "string",
                        "description": "Serialized payload passed to the handler"
                    },
                    "config": {
                        "type": "object",
                        "description": "Current app configuration passed to handlers that accept a config argument",
                        "additionalProperties": {
                            "type": "string"
                        }
                    }
                },
                "required": [
                    "handler_name",
                    "config"
                ]
            },
            "CallSchemaHandlerResponse": {
                "type": "object",
                "properties": {
                    "result": {
                        "type": "string",
                        "description": "Raw handler response"
                    }
                },
                "required": [
                    "result"
                ]
            },
            "RefreshAppsResponse": {
                "type": "object",
                "properties": {
                    "status": {
                        "type": "string",
                        "example": "success"
                    },
                    "message": {
                        "type": "string",
                        "example": "App registry refreshed successfully"
                    },
                    "app_count": {
                        "type": "integer",
                        "example": 42
                    }
                },
                "required": [
                    "status",
                    "message",
                    "app_count"
                ]
            },
            "AppSchemaFieldCommon": {
                "type": "object",
                "properties": {
                    "id": {
                        "type": "string",
                        "description": "Field identifier"
                    },
                    "name": {
                        "type": "string",
                        "description": "Human readable label"
                    },
                    "description": {
                        "type": "string",
                        "description": "Helper text"
                    },
                    "icon": {
                        "type": "string",
                        "description": "Optional icon"
                    },
                    "visibility": {
                        "$ref": "#/components/schemas/AppSchemaVisibility"
                    },
                    "default": {
                        "type": "string",
                        "description": "Default value serialized as text"
                    }
                },
                "required": [
                    "id"
                ]
            },
            "AppSchemaColorField": {
                "description": "Config value: hex color string (#RRGGBB or #RGB)",
                "allOf": [
                    {
                        "$ref": "#/components/schemas/AppSchemaFieldCommon"
                    },
                    {
                        "type": "object",
                        "properties": {
                            "type": {
                                "type": "string",
                                "enum": [
                                    "color"
                                ]
                            },
                            "default": {
                                "type": "string",
                                "format": "color",
                                "description": "Default hex color (e.g. #FF0000)"
                            },
                            "palette": {
                                "type": "array",
                                "items": {
                                    "type": "string"
                                }
                            }
                        },
                        "required": [
                            "type"
                        ]
                    }
                ]
            },
            "AppSchemaDatetimeField": {
                "description": "Config value: ISO 8601 / RFC 3339 datetime string",
                "allOf": [
                    {
                        "$ref": "#/components/schemas/AppSchemaFieldCommon"
                    },
                    {
                        "type": "object",
                        "properties": {
                            "type": {
                                "type": "string",
                                "enum": [
                                    "datetime"
                                ]
                            },
                            "default": {
                                "type": "string",
                                "format": "date-time",
                                "description": "Default datetime in ISO 8601 format"
                            }
                        },
                        "required": [
                            "type"
                        ]
                    }
                ]
            },
            "AppSchemaDropdownField": {
                "description": "Config value: string matching one of the option values",
                "allOf": [
                    {
                        "$ref": "#/components/schemas/AppSchemaFieldCommon"
                    },
                    {
                        "type": "object",
                        "properties": {
                            "type": {
                                "type": "string",
                                "enum": [
                                    "dropdown"
                                ]
                            },
                            "options": {
                                "type": "array",
                                "items": {
                                    "$ref": "#/components/schemas/AppSchemaOption"
                                }
                            }
                        },
                        "required": [
                            "type",
                            "options"
                        ]
                    }
                ]
            },
            "AppSchemaGeneratedField": {
                "description": "Config value: none (dynamically generated from source field via handler)",
                "allOf": [
                    {
                        "$ref": "#/components/schemas/AppSchemaFieldCommon"
                    },
                    {
                        "type": "object",
                        "properties": {
                            "type": {
                                "type": "string",
                                "enum": [
                                    "generated"
                                ]
                            },
                            "source": {
                                "type": "string",
                                "description": "Field ID used as source for generated fields"
                            },
                            "handler": {
                                "type": "string",
                                "description": "Pixlet handler invoked for dynamic data"
                            }
                        },
                        "required": [
                            "type",
                            "source",
                            "handler"
                        ]
                    }
                ]
            },
            "AppSchemaLocationField": {
                "description": "Config value: JSON object or JSON string with lat, lng (required), and optional description, locality, place_id, timezone",
                "allOf": [
                    {
                        "$ref": "#/components/schemas/AppSchemaFieldCommon"
                    },
                    {
                        "type": "object",
                        "properties": {
                            "type": {
                                "type": "string",
                                "enum": [
                                    "location"
                                ]
                            }
                        },
                        "required": [
                            "type"
                        ]
                    }
                ]
            },
            "AppSchemaLocationBasedField": {
                "description": "Config value: JSON object or JSON string with value (required) and display (optional)",
                "allOf": [
                    {
                        "$ref": "#/components/schemas/AppSchemaFieldCommon"
                    },
                    {
                        "type": "object",
                        "properties": {
                            "type": {
                                "type": "string",
                                "enum": [
                                    "locationbased"
                                ]
                            },
                            "handler": {
                                "type": "string",
                                "description": "Pixlet handler invoked with location JSON to generate options"
                            }
                        },
                        "required": [
                            "type",
                            "handler"
                        ]
                    }
                ]
            },
            "AppSchemaOnOffField": {
                "description": "Config value: boolean or string parseable as boolean (true, false, 1, 0)",
                "allOf": [
                    {
                        "$ref": "#/components/schemas/AppSchemaFieldCommon"
                    },
                    {
                        "type": "object",
                        "properties": {
                            "type": {
                                "type": "string",
                                "enum": [
                                    "onoff"
                                ]
                            }
                        },
                        "required": [
                            "type"
                        ]
                    }
                ]
            },
            "AppSchemaRadioField": {
                "description": "Config value: string matching one of the option values",
                "allOf": [
                    {
                        "$ref": "#/components/schemas/AppSchemaFieldCommon"
                    },
                    {
                        "type": "object",
                        "properties": {
                            "type": {
                                "type": "string",
                                "enum": [
                                    "radio"
                                ]
                            },
                            "options": {
                                "type": "array",
                                "items": {
                                    "$ref": "#/components/schemas/AppSchemaOption"
                                }
                            }
                        },
                        "required": [
                            "type",
                            "options"
                        ]
                    }
                ]
            },
            "AppSchemaTextField": {
                "description": "Config value: plain text string",
                "allOf": [
                    {
                        "$ref": "#/components/schemas/AppSchemaFieldCommon"
                    },
                    {
                        "type": "object",
                        "properties": {
                            "type": {
                                "type": "string",
                                "enum": [
                                    "text"
                                ]
                            }
                        },
                        "required": [
                            "type"
                        ]
                    }
                ]
            },
            "AppSchemaTypeaheadField": {
                "description": "Config value: JSON object or JSON string with value (required) and display (optional)",
                "allOf": [
                    {
                        "$ref": "#/components/schemas/AppSchemaFieldCommon"
                    },
                    {
                        "type": "object",
                        "properties": {
                            "type": {
                                "type": "string",
                                "enum": [
                                    "typeahead"
                                ]
                            },
                            "handler": {
                                "type": "string",
                                "description": "Pixlet handler invoked with search pattern to generate options"
                            }
                        },
                        "required": [
                            "type",
                            "handler"
                        ]
                    }
                ]
            },
            "AppSchemaOAuth2Field": {
                "description": "Config value: access token string returned by handler",
                "allOf": [
                    {
                        "$ref": "#/components/schemas/AppSchemaFieldCommon"
                    },
                    {
                        "type": "object",
                        "properties": {
                            "type": {
                                "type": "string",
                                "enum": [
                                    "oauth2"
                                ]
                            },
                            "handler": {
                                "type": "string",
                                "description": "Pixlet handler invoked for dynamic data"
                            },
                            "client_id": {
                                "type": "string",
                                "description": "OAuth client identifier"
                            },
                            "pkce": {
                                "type": "boolean",
                                "description": "Indicates if PKCE is used, S256 method will be used if true, and the handler will recieve an additional code_verifier parameter."
                            },
                            "authorization_endpoint": {
                                "type": "string",
                                "description": "OAuth authorization endpoint"
                            },
                            "scopes": {
                                "type": "array",
                                "items": {
                                    "type": "string"
                                }
                            },
                            "user_defined_client": {
                                "type": "boolean",
                                "description": "If true, the user provides their own OAuth client credentials. Mutually exclusive with client_id."
                            }
                        },
                        "required": [
                            "type",
                            "handler",
                            "authorization_endpoint",
                            "scopes"
                        ]
                    }
                ]
            },
            "AppSchemaOAuth1Field": {
                "description": "Config value: authorization token string",
                "allOf": [
                    {
                        "$ref": "#/components/schemas/AppSchemaFieldCommon"
                    },
                    {
                        "type": "object",
                        "properties": {
                            "type": {
                                "type": "string",
                                "enum": [
                                    "oauth1"
                                ]
                            }
                        },
                        "required": [
                            "type"
                        ]
                    }
                ]
            },
            "AppSchemaPNGField": {
                "description": "Config value: base64-encoded image data, optionally with data URI prefix (data:image/png;base64,...)",
                "allOf": [
                    {
                        "$ref": "#/components/schemas/AppSchemaFieldCommon"
                    },
                    {
                        "type": "object",
                        "properties": {
                            "type": {
                                "type": "string",
                                "enum": [
                                    "png"
                                ]
                            }
                        },
                        "required": [
                            "type"
                        ]
                    }
                ]
            },
            "AppSchemaNotificationField": {
                "description": "Config value: non-empty string",
                "allOf": [
                    {
                        "$ref": "#/components/schemas/AppSchemaFieldCommon"
                    },
                    {
                        "type": "object",
                        "properties": {
                            "type": {
                                "type": "string",
                                "enum": [
                                    "notification"
                                ]
                            },
                            "sounds": {
                                "type": "array",
                                "items": {
                                    "$ref": "#/components/schemas/AppSchemaSound"
                                }
                            }
                        },
                        "required": [
                            "type",
                            "sounds"
                        ]
                    }
                ]
            },
            "AppSchemaGeoJSONField": {
                "description": "Config value: GeoJSON string or object (RFC 7946 geometry, e.g. Polygon or Point)",
                "allOf": [
                    {
                        "$ref": "#/components/schemas/AppSchemaFieldCommon"
                    },
                    {
                        "type": "object",
                        "properties": {
                            "type": {
                                "type": "string",
                                "enum": [
                                    "geojson"
                                ]
                            },
                            "collect_point": {
                                "type": "boolean",
                                "description": "If true, enables point collection on the map UI in addition to polygon drawing"
                            }
                        },
                        "required": [
                            "type"
                        ]
                    }
                ]
            }
        }
    }
}