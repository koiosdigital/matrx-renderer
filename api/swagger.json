{
    "openapi": "3.0.0",
    "info": {
        "title": "Matrx Renderer API",
        "description": "HTTP API for managing and rendering Pixlet applications for Matrx devices",
        "version": "1.0.0"
    },
    "servers": [
        {
            "url": "http://localhost:8080",
            "description": "Local development server"
        }
    ],
    "paths": {
        "/health": {
            "get": {
                "summary": "Health check",
                "description": "Returns the health status of the service",
                "operationId": "getHealth",
                "responses": {
                    "200": {
                        "description": "Service is healthy",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "status": {
                                            "type": "string",
                                            "example": "healthy"
                                        },
                                        "service": {
                                            "type": "string",
                                            "example": "matrx-renderer"
                                        },
                                        "version": {
                                            "type": "string",
                                            "example": "1.0.0"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "/apps": {
            "get": {
                "summary": "List all apps",
                "description": "Returns a list of all available Pixlet applications",
                "operationId": "listApps",
                "responses": {
                    "200": {
                        "description": "List of apps",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "array",
                                    "items": {
                                        "type": "object",
                                        "properties": {
                                            "id": {
                                                "type": "string",
                                                "description": "Unique app identifier"
                                            },
                                            "name": {
                                                "type": "string",
                                                "description": "Display name of the app"
                                            },
                                            "summary": {
                                                "type": "string",
                                                "description": "Brief description of the app"
                                            },
                                            "author": {
                                                "type": "string",
                                                "description": "App author"
                                            },
                                            "desc": {
                                                "type": "string",
                                                "description": "Detailed description of the app"
                                            },
                                            "filename": {
                                                "type": "string",
                                                "description": "Source file name"
                                            },
                                            "package_name": {
                                                "type": "string",
                                                "description": "Internal package name"
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "/apps/refresh": {
            "post": {
                "summary": "Refresh app registry",
                "description": "Reloads the app registry from the filesystem",
                "operationId": "refreshApps",
                "responses": {
                    "200": {
                        "description": "Apps refreshed successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "status": {
                                            "type": "string",
                                            "example": "success"
                                        },
                                        "message": {
                                            "type": "string",
                                            "example": "App registry refreshed successfully"
                                        },
                                        "app_count": {
                                            "type": "integer",
                                            "example": 42
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Failed to refresh apps"
                    }
                }
            }
        },
        "/apps/{id}": {
            "get": {
                "summary": "Get app details",
                "description": "Returns detailed information about a specific app",
                "operationId": "getApp",
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "description": "App identifier",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "App details",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "id": {
                                            "type": "string"
                                        },
                                        "name": {
                                            "type": "string"
                                        },
                                        "summary": {
                                            "type": "string"
                                        },
                                        "author": {
                                            "type": "string"
                                        },
                                        "desc": {
                                            "type": "string"
                                        },
                                        "filename": {
                                            "type": "string"
                                        },
                                        "package_name": {
                                            "type": "string"
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "App not found"
                    }
                }
            }
        },
        "/apps/{id}/schema": {
            "get": {
                "summary": "Get app schema",
                "description": "Returns the schema definition for a specific app",
                "operationId": "getAppSchema",
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "description": "App identifier",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "App schema",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "description": "Schema structure varies by app"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "App not found"
                    },
                    "500": {
                        "description": "Failed to load schema"
                    }
                }
            },
            "post": {
                "summary": "Validate schema configuration",
                "description": "Validates a configuration against the app's schema",
                "operationId": "validateSchema",
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "description": "App identifier",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "description": "Configuration object to validate against the schema"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Validation result",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "valid": {
                                            "type": "boolean"
                                        },
                                        "errors": {
                                            "type": "array",
                                            "items": {
                                                "type": "object",
                                                "properties": {
                                                    "field": {
                                                        "type": "string"
                                                    },
                                                    "message": {
                                                        "type": "string"
                                                    },
                                                    "code": {
                                                        "type": "string"
                                                    }
                                                }
                                            }
                                        },
                                        "normalized_config": {
                                            "type": "object",
                                            "description": "Config with schema defaults applied"
                                        }
                                    }
                                }
                            }
                        }
                    }
                },
                "404": {
                    "description": "App not found"
                }
            }
        }
    },
    "/apps/{id}/render": {
        "post": {
            "summary": "Render app",
            "description": "Renders an app configuration and returns the base64-encoded WebP output.",
            "operationId": "renderApp",
            "parameters": [
                {
                    "name": "id",
                    "in": "path",
                    "required": true,
                    "description": "App identifier",
                    "schema": {
                        "type": "string"
                    }
                },
                {
                    "name": "width",
                    "in": "query",
                    "required": false,
                    "description": "Device width in pixels (default 64)",
                    "schema": {
                        "type": "integer",
                        "format": "int32"
                    }
                },
                {
                    "name": "height",
                    "in": "query",
                    "required": false,
                    "description": "Device height in pixels (default 32)",
                    "schema": {
                        "type": "integer",
                        "format": "int32"
                    }
                },
                {
                    "name": "device_id",
                    "in": "query",
                    "required": false,
                    "description": "Optional device identifier used for logging",
                    "schema": {
                        "type": "string"
                    }
                }
            ],
            "requestBody": {
                "required": true,
                "content": {
                    "application/json": {
                        "schema": {
                            "type": "object",
                            "description": "Configuration object matching the app schema"
                        }
                    }
                }
            },
            "responses": {
                "200": {
                    "description": "Render result",
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "result": {
                                        "type": "object",
                                        "properties": {
                                            "type": {
                                                "type": "string"
                                            },
                                            "uuid": {
                                                "type": "string"
                                            },
                                            "device_id": {
                                                "type": "string"
                                            },
                                            "app_id": {
                                                "type": "string"
                                            },
                                            "render_output": {
                                                "type": "string",
                                                "description": "Base64 encoded WebP image"
                                            },
                                            "processed_at": {
                                                "type": "string",
                                                "format": "date-time"
                                            }
                                        }
                                    },
                                    "normalized_config": {
                                        "type": "object",
                                        "description": "Config with schema defaults applied"
                                    }
                                }
                            }
                        }
                    }
                },
                "404": {
                    "description": "App not found"
                },
                "422": {
                    "description": "Validation failed",
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "valid": {
                                        "type": "boolean"
                                    },
                                    "errors": {
                                        "type": "array",
                                        "items": {
                                            "type": "object",
                                            "properties": {
                                                "field": {
                                                    "type": "string"
                                                },
                                                "message": {
                                                    "type": "string"
                                                },
                                                "code": {
                                                    "type": "string"
                                                }
                                            }
                                        }
                                    },
                                    "normalized_config": {
                                        "type": "object"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    },
    "/apps/{id}/preview.webp": {
        "get": {
            "summary": "Render WebP preview",
            "description": "Renders an app using schema defaults (no request body) and returns binary WebP output.",
            "operationId": "previewWebP",
            "parameters": [
                {
                    "name": "id",
                    "in": "path",
                    "required": true,
                    "description": "App identifier",
                    "schema": {
                        "type": "string"
                    }
                },
                {
                    "name": "width",
                    "in": "query",
                    "required": false,
                    "description": "Device width in pixels (default 64)",
                    "schema": {
                        "type": "integer",
                        "format": "int32"
                    }
                },
                {
                    "name": "height",
                    "in": "query",
                    "required": false,
                    "description": "Device height in pixels (default 32)",
                    "schema": {
                        "type": "integer",
                        "format": "int32"
                    }
                },
                {
                    "name": "device_id",
                    "in": "query",
                    "required": false,
                    "description": "Optional device identifier used for logging",
                    "schema": {
                        "type": "string"
                    }
                }
            ],
            "responses": {
                "200": {
                    "description": "Binary WebP image",
                    "content": {
                        "image/webp": {
                            "schema": {
                                "type": "string",
                                "format": "binary"
                            }
                        }
                    }
                },
                "404": {
                    "description": "App not found"
                },
                "422": {
                    "description": "Validation failed",
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "valid": {
                                        "type": "boolean"
                                    },
                                    "errors": {
                                        "type": "array",
                                        "items": {
                                            "type": "object",
                                            "properties": {
                                                "field": {
                                                    "type": "string"
                                                },
                                                "message": {
                                                    "type": "string"
                                                },
                                                "code": {
                                                    "type": "string"
                                                }
                                            }
                                        }
                                    },
                                    "normalized_config": {
                                        "type": "object"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    },
    "/apps/{id}/preview.gif": {
        "get": {
            "summary": "Render GIF preview",
            "description": "Renders an app using schema defaults (no request body) and returns binary GIF output.",
            "operationId": "previewGif",
            "parameters": [
                {
                    "name": "id",
                    "in": "path",
                    "required": true,
                    "description": "App identifier",
                    "schema": {
                        "type": "string"
                    }
                },
                {
                    "name": "width",
                    "in": "query",
                    "required": false,
                    "description": "Device width in pixels (default 64)",
                    "schema": {
                        "type": "integer",
                        "format": "int32"
                    }
                },
                {
                    "name": "height",
                    "in": "query",
                    "required": false,
                    "description": "Device height in pixels (default 32)",
                    "schema": {
                        "type": "integer",
                        "format": "int32"
                    }
                },
                {
                    "name": "device_id",
                    "in": "query",
                    "required": false,
                    "description": "Optional device identifier used for logging",
                    "schema": {
                        "type": "string"
                    }
                }
            ],
            "responses": {
                "200": {
                    "description": "Binary GIF image",
                    "content": {
                        "image/gif": {
                            "schema": {
                                "type": "string",
                                "format": "binary"
                            }
                        }
                    }
                },
                "404": {
                    "description": "App not found"
                },
                "422": {
                    "description": "Validation failed",
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "valid": {
                                        "type": "boolean"
                                    },
                                    "errors": {
                                        "type": "array",
                                        "items": {
                                            "type": "object",
                                            "properties": {
                                                "field": {
                                                    "type": "string"
                                                },
                                                "message": {
                                                    "type": "string"
                                                },
                                                "code": {
                                                    "type": "string"
                                                }
                                            }
                                        }
                                    },
                                    "normalized_config": {
                                        "type": "object"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    },
    "/apps/{id}/call_handler": {
        "post": {
            "summary": "Call schema handler",
            "description": "Calls a schema handler for dynamic field options",
            "operationId": "callSchemaHandler",
            "parameters": [
                {
                    "name": "id",
                    "in": "path",
                    "required": true,
                    "description": "App identifier",
                    "schema": {
                        "type": "string"
                    }
                }
            ],
            "requestBody": {
                "required": true,
                "content": {
                    "application/json": {
                        "schema": {
                            "type": "object",
                            "properties": {
                                "handler": {
                                    "type": "string",
                                    "description": "Handler name to call"
                                },
                                "config": {
                                    "type": "object",
                                    "description": "Current configuration values"
                                }
                            }
                        }
                    }
                }
            },
            "responses": {
                "200": {
                    "description": "Handler result",
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "options": {
                                        "type": "array",
                                        "items": {
                                            "type": "object"
                                        }
                                    }
                                }
                            }
                        }
                    }
                },
                "400": {
                    "description": "Invalid request"
                },
                "404": {
                    "description": "App or handler not found"
                }
            }
        }
    },
    "/swagger.json": {
        "get": {
            "summary": "OpenAPI specification",
            "description": "Returns the OpenAPI/Swagger specification for this API",
            "operationId": "getSwagger",
            "responses": {
                "200": {
                    "description": "OpenAPI specification",
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object"
                            }
                        }
                    }
                }
            }
        }
    }
}
}